---
title: "Cervical Cancer"
author: "Wai Ming Lee"
date: "12/7/2017"
output: html_document
---

Our Objective: 
Predict: Dependent variable "Cervical cancer" = "Hinselmann" + "Schiller" + "Citology" + "Biopsy"

Rationale: "The last four features represent medical exams that determine the likelyhood of that person having cancer, as far as I know there is no feature that confirms if a person has cervical cancer in this dataset - so I approached it as a risk instead.

The target variable that I created represent groups of people with varying degrees of risk of having cervical cancer.

From my previous experience in a cancer related NGO, a single exam isn't enough to determine if a person has cancer or not - it's a big diagnostic and often more medical exams are required to determine the final diagnostic (since exams can also yield false positives and false negatives)."

# Table of Contents
Summary
Description of the Problem
Description of the Data
  Response Variable (y)
Data Cleaning and Preparation (EDA)
Model Description
  Logistic Regression Overview
  Logistic Regression Results
Alternative Methods
  Overview of Boosting Method
  Results of Boosting Method
Comparison of Methods
Validity of Results and Future Improvement
Conclusion

# Summary


# Description of the Problem

The incidence of cervical cancer in the US has decreased singnificanty over the past 40 years (from being the #1 cause of death for women in the US to being 14th in frequency), mosly due to early detection due to pap smear screening. However, it still remains a large source of morbidity and mortality both in the US and globally. In 2014, there were over 12,500 new cervical cancer diagnoses and over 4,000 cervical cancer-associated deaths in the US alone. On a global scale, cervical cancer is still the 3rd most common neoplasia and the #2 cause of cancer-related deaths among women. Cervical cancer is almost exclusively caused by the human papilloma virus (HPV), a sommon sexually transmitted disease. There are multiple subtypes of HPV, some of which are associated with warts and others which are notorious for causing cervical cancer. Although recently the US Food and Drug Administration (FDA) has approved Gardasil and Cevarix, two vaccines that protect against "high risk" types of cervical cancer, these vaccines do not protect against all types of cervical cancer. In order to further decrease the incidence of cervical cancer, it is important to understand what behavioral and demographic factors increase the risk of acquiring cervical cancer. Thus, the goal of our analysis is two-fold: 1) to identify factors that increase the risk of cervical cancer and 2) to develop a model that predicts the risk of cervical cancer.

# Description of the Data Set

The dataset was obtained from kaggle () and was collected through administering questionnaires to 858 patients at 'Hospital Universitario de Caracas' in Caracas, Venezuela. It includes demographic information, habits, and historic medical records of the patients in question. Missing values correspond to patients who failed to answer a question due to privacy concerns. A more detailed description of each variable is outlined below:

Demographic/behavioral variables:
  1) $Age$ (integer) - Corresponds to the age at which the patient filled the questionnaire
  2) $Number.of.sexual.partners$ (integer) - Numer of sexual partners
  3) $First.sexual.intercourse$ (integer) - Age at first sexual intercourse
  4) $Num.of.pregnancies$ (integer) - Number of pregnancies
  5) $Smoker.status$ (factor) - Categorical value that corresponds to whether someone is a non-smoker (0), light-medium smoker (1), or heavy smoker (2). This variable was generated by using the following transformation to define "pack-years": $Packyears = Smokes (yes=1, no=0) \times Smokes (years) \times Smokes (packs/year)$. Then, pack years was log transformed ($log(packyears+1)$) because, when excluding non-smokers ($log(packyears+1)=0$), the distribution for number of $log(packyears+1)$ looks more normal. We calculated the mean for this group ($mean(log(packyears+1))=2.346$) and 0-2 were assigned as follows:
    a) $Non-smoker(0)$: 0 log(packyears+1)
    b) $Light-Medium smoker (1)$: Between 0 and 2.346 log(packyears+1)
    c) $Heavy smoker (2)$: > 2.346 log(packyears+1)
  6) $log.Years.HCP$ (integer)** - Generated by multiplying $Years.HCP = Hormonal.Contraceptives(yes=1,no=0) \times Hormonal.Contraceptive.Years$ then taking the log transofrmation: $log.Years.HCP = log(Years.HCP + 1)$
  7) $log.Years.IUD$ (integer)** - Generated by multiplying $Years.IUD = IUD(yes=1,no=0) \times IUD.Years$ then taking the log transofrmation: $log.Years.IUD = log(Years.IUD + 1)$
  ** The variables $log.Years.HCP$ and $log.Years.IUC$ were used instead of $Years.HCP$ and $Years.IUD$ respectively because, when you eliminate patients without HCP and IUD's, the log distributions are closer to being normally distributed (see EDA below).
  
  
Response variable:
  1) $Cervical.Cancer$ (factor) - Categorical variable generated as the sum of $

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
str(data)
```

```{r}
data <- read.csv("kag_risk_factors_cervical_cancer.csv")
str(data)
```

# EDA & Transformations

```{r}
# Smoking
summary(data$Smokes..years.)
summary(data$Smokes..packs.year.)
data$packyears <- as.numeric(as.character(data$Smokes)) * as.numeric(as.character(data$Smokes..years.)) *
  as.numeric(as.character(data$Smokes..packs.year.))
summary(data$Smokes)
summary(data$packyears)
summary(data$packyears[-c(which(is.na(data$packyears)))])
packyears <- data$packyears
packyears <- packyears[-c(which(is.na(packyears)))]

# Distribution
hist(packyears)
hist(log(packyears+1))

# Without packyears == 0
hist(packyears[-c(which(packyears == 0))])
summary(packyears[-c(which(packyears == 0))])
hist(log(packyears+1)[-c(which(log(packyears+1) == log(1)))]) # Looks more normal, you can split people below the mean as low-medium smokers and above the mean as heavy smokers
summary(log(packyears+1)[-c(which(log(packyears+1) == log(1)))])

# Create Smoker.status
data$Smoker.status <- rep("1", length(data$packyears))
nonsmoker.index <- c(which(log(data$packyears+1) == 0))
heavy.index <- c(which(log(data$packyears+1) > 2.346))
na.index <- c(which(is.na(data$packyears)))
data$Smoker.status[nonsmoker.index] <- "0"
data$Smoker.status[heavy.index] <- "2"
data$Smoker.status[na.index] <- "?"
data$Smoker.status <- as.factor(data$Smoker.status)
summary(data$Smoker.status)
```

```{r}
# Hormonal contraceptives
str(data)
summary(data$Hormonal.Contraceptives)
summary(data$Hormonal.Contraceptives..years.)
# Create Years.HCP
data$Years.HCP <- as.numeric(as.character(data$Hormonal.Contraceptives)) * 
  as.numeric(as.character(data$Hormonal.Contraceptives..years.))
summary(data$Years.HCP)
# Histogram HCP
histogram(data$Years.HCP[-c(which(is.na(data$Years.HCP)))]) 
# Histogram log(HCP+1)
histogram(log(data$Years.HCP[-c(which(is.na(data$Years.HCP)))]+1))   
# The log transformed data should be closer to normal is you remove first peak
log.years.hcp <- log(data$Years.HCP[-c(which(is.na(data$Years.HCP)))]+1)
log.years.hcp <- log.years.hcp[-c(which(log.years.hcp == log(1)))]
histogram(log.years.hcp)
# Create log.Years.HCP
data$log.Years.HCP <- log(data$Years.HCP+1)
summary(data$log.Years.HCP)


# IUD's
summary(data$IUD)
summary(data$IUD..years.)
# Create Years.IUD
data$Years.IUD <- as.numeric(as.character(data$IUD)) * as.numeric(as.character(data$IUD..years.))
summary(data$Years.IUD)
# Histogram IUD
histogram(data$Years.IUD[-c(which(is.na(data$Years.IUD)))]) 
# Histogram log(IUD+1)
histogram(log(data$Years.IUD[-c(which(is.na(data$Years.IUD)))]+1))  
# The log transformed data should be closer to normal is you remove first peak
log.years.iud <- log(data$Years.IUD[-c(which(is.na(data$Years.IUD)))]+1)
log.years.iud <- log.years.iud[-c(which(log.years.iud == log(1)))]
histogram(log.years.iud)
# Create log.Years.IUD
data$log.Years.IUD <- log(data$Years.IUD+1)
summary(data$log.Years.IUD)
```

